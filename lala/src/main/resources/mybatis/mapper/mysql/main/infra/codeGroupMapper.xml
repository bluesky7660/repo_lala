<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.lalaping.infra.codegroup.CodeGroupDao">
<!-- namespace:mapper와 연결될 dao파일  -->
<!-- xml에서 주석 단축키 : ctrl + shift + c -->

	<resultMap type="com.lalaping.infra.codegroup.CodeGroupDto" id="resultMapObj"></resultMap>
	<sql id="selectCommon">
		FROM
			codegroup a
			<!-- left JOIN commoncode b ON b.codeGroup_seq = a.seq -->
		WHERE 1=1
			<if test="shValue != null and !shValue.equals('')">
				<choose>
					<when test="shOption == null">
	                    AND(
							a.cgSeq Like CONCAT('%',#{shValue},'%')
							OR a.cgName Like CONCAT('%',#{shValue},'%')
						)
	                </when>
					<when test="shOption == 1 and shOption != null and shOption != ''">
					    AND a.cgSeq = #{shValue}
					</when>
					<when test="shOption == 2 and shOption != null and shOption != ''">
					    AND a.cgName LIKE CONCAT('%', #{shValue}, '%')
					</when>
				</choose>
			</if>
			<if test="shUseNy != null and !shUseNy.equals('')">
				AND a.cgUseNy = #{shUseNy}
			</if>
			<if test="shDelNy != null and !shDelNy.equals('')">
				AND a.cgDelNy = #{shDelNy}
			</if>
			<if test="( shDateStart != null and !shDateStart.equals('')) and ( shDateEnd != null and !shDateEnd.equals(''))">
				<choose>
					<when test="shOptionDate == 1"> AND a.cgRegDate BETWEEN #{shDateStart} AND #{shDateEnd}</when>
					<when test="shOptionDate == 2"> AND a.cgModDate BETWEEN #{shDateStart} AND #{shDateEnd}</when>
				</choose>
			</if>
			
	</sql>
	<select id="selectList" resultMap="resultMapObj">
		<include refid="base.selectListUpperForMysql"/>
		SELECT
			a.cgSeq
			,a.cgName
			,a.cgDesc
			,a.cgOrder
			,(select count(aa.codeGroup_cgSeq) from commoncode aa  where 1=1 and aa.codeGroup_cgSeq = a.cgSeq) as cgCodeCount
			,a.cgUseNy
		    ,a.cgDelNy
			,a.cgRegDate
			,a.cgModDate
		<include refid="selectCommon"/>
		ORDER BY
			a.cgOrder desc
		<include refid="base.selectListLowerForMysql"/>
	</select>
	<select id="listCount" resultType="int">
        SELECT COUNT(*) 
        <include refid="selectCommon"/>
    </select>
</mapper>		